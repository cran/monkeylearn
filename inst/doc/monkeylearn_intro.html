<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="M. Salmon, A. Dobbyn" />

<meta name="date" content="2018-04-13" />

<title>monkeylearn, a R Package for Natural Language Processing Using Monkeylearn Existing Modules</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">monkeylearn, a R Package for Natural Language Processing Using Monkeylearn Existing Modules</h1>
<h4 class="author"><em>M. Salmon, A. Dobbyn</em></h4>
<h4 class="date"><em>2018-04-13</em></h4>



<div id="intro" class="section level1">
<h1>Intro</h1>
<p>This package is an interface to the <a href="http://docs.monkeylearn.com/article/api-reference/">MonkeyLearn API</a>. MonkeyLearn is a Machine Learning platform on the cloud that allows software companies and developers to easily extract actionable data from text.</p>
<p>The goal of the package is not to support machine learning algorithms development with R or the API, but only to <em>reap the benefits of the existing modules on Monkeylearn</em>. Therefore, there are only two functions, one for using <em>extractors</em>, and one for using <em>classifiers</em>. The difference between extractors and classifiers is that extractors output information about words, whereas classifiers output information about each text as a whole. Named entity recognition is an extraction task, whereas assigning a topic to a text is a classification task.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>To get an API key for MonkeyLearn, register at <a href="http://monkeylearn.com/" class="uri">http://monkeylearn.com/</a>. Note that MonkeyLearn supports registration through GitHub, which makes the registration process really easy. For ease of use, save your API key as an environment variable as described at <a href="http://stat545.com/bit003_api-key-env-var.html" class="uri">http://stat545.com/bit003_api-key-env-var.html</a>. You might also want to use the <code>usethis::edit_r_environ()</code> function to modify .Renviron.</p>
<p>All functions of the package will conveniently look for your API key using <code>Sys.getenv(&quot;MONKEYLEARN_KEY&quot;)</code> so if your API key is an environment variable called “MONKEYLEARN_KEY” you don’t need to input it manually.</p>
<p>Please also create a “MONKEYLEARN_PLAN” environment variable indicating whether your <a href="https://app.monkeylearn.com/main/my-account/tab/change-plan/">Monkeylearn plan</a> is “free”, “team”, “business” or “custom”. If you do not indicate it by default it will be “free” with a message. If your plan is “custom” you’ll need a third environment variable “MONKEYLEARN_RATE” indicating the maximum amount of requests per minute that you can make to the API. If you do not indicate it, by default it will be 120 with a message.</p>
</div>
<div id="so-many-monkeysfunctions" class="section level2">
<h2>So many monkeys/functions</h2>
<p>The packages exports <code>monkeylearn_classify</code>, <code>monkey_classify</code>, <code>monkeylearn_extract</code>, <code>monkey_extract</code>. The <code>monkey_</code> functions are the newer and better ones, so if you don’t have legacy code, just start using those!</p>
<p>For inspiration beyond this vignette, you can see external examples of the package in action <a href="http://ropensci.github.io/monkeylearn/">on this page</a>. In particular you’ll find examples using the older set of functions but we now recommend using <code>monkey_extract</code> and <code>monkey_classify</code>, see more later in the vignette.</p>
</div>
</div>
<div id="extract" class="section level1">
<h1>Extract</h1>
<div id="a-first-example" class="section level2">
<h2>A first example</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(monkeylearn)
<span class="kw">library</span>(magrittr)

text &lt;-<span class="st"> &quot;In the 19th century, the major European powers had gone to great lengths to maintain a balance of power throughout Europe, resulting in the existence of a complex network of political and military alliances throughout the continent by 1900.[7] These had started in 1815, with the Holy Alliance between Prussia, Russia, and Austria. Then, in October 1873, German Chancellor Otto von Bismarck negotiated the League of the Three Emperors (German: Dreikaiserbund) between the monarchs of Austria-Hungary, Russia and Germany.&quot;</span>
output &lt;-<span class="st"> </span><span class="kw">monkey_extract</span>(<span class="dt">input =</span> text,
                         <span class="dt">extractor_id =</span> <span class="st">&quot;ex_isnnZRbS&quot;</span>)
output
<span class="co">#&gt; # A tibble: 7 x 4</span>
<span class="co">#&gt;   req                                                  count tag    entity</span>
<span class="co">#&gt;   &lt;chr&gt;                                                &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; </span>
<span class="co">#&gt; 1 In the 19th century, the major European powers had …     1 LOCAT… Europe</span>
<span class="co">#&gt; 2 In the 19th century, the major European powers had …     1 LOCAT… Pruss…</span>
<span class="co">#&gt; 3 In the 19th century, the major European powers had …     1 LOCAT… Austr…</span>
<span class="co">#&gt; 4 In the 19th century, the major European powers had …     1 LOCAT… Austr…</span>
<span class="co">#&gt; 5 In the 19th century, the major European powers had …     1 LOCAT… Germa…</span>
<span class="co">#&gt; 6 In the 19th century, the major European powers had …     1 PERSON Otto …</span>
<span class="co">#&gt; 7 In the 19th century, the major European powers had …     2 LOCAT… Russia</span>
<span class="kw">attr</span>(output, <span class="st">&quot;headers&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 11</span>
<span class="co">#&gt;   server  date   content.type transfer.encodi… connection x.query.limit.l…</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;           </span>
<span class="co">#&gt; 1 nginx/… Fri, … application… chunked          keep-alive 100000          </span>
<span class="co">#&gt; # ... with 5 more variables: x.query.limit.remaining &lt;chr&gt;,</span>
<span class="co">#&gt; #   x.query.limit.request.queries &lt;chr&gt;, allow &lt;chr&gt;,</span>
<span class="co">#&gt; #   content.encoding &lt;chr&gt;, text_md5 &lt;chr&gt;</span></code></pre></div>
</div>
<div id="parameters" class="section level2">
<h2>Parameters</h2>
<p>If the documentation of the extractor you use states it has parameters, you can pass them as a named list, see below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> &quot;A panel of Goldman Sachs employees spent a recent Tuesday night at the</span>
<span class="st">Columbia University faculty club trying to convince a packed room of potential</span>
<span class="st">recruits that Wall Street, not Silicon Valley, was the place to be for computer</span>
<span class="st">scientists.</span><span class="ch">\n\n</span><span class="st"> The Goldman employees knew they had an uphill battle. They were</span>
<span class="st">fighting against perceptions of Wall Street as boring and regulation-bound and</span>
<span class="st">Silicon Valley as the promised land of flip-flops, beanbag chairs and million-dollar</span>
<span class="st">stock options.</span><span class="ch">\n\n</span><span class="st"> Their argument to the room of technologically inclined students</span>
<span class="st">was that Wall Street was where they could find far more challenging, diverse and,</span>
<span class="st">yes, lucrative jobs working on some of the worlds most difficult technical problems.&quot;</span>

output &lt;-<span class="st"> </span><span class="kw">monkey_extract</span>(text,
                        <span class="dt">extractor_id =</span> <span class="st">&quot;ex_y7BPYzNG&quot;</span>,
                        <span class="dt">params =</span> <span class="kw">list</span>(<span class="dt">max_keywords =</span> <span class="dv">3</span>))
<span class="co">#&gt; Processing batch 1 of 1 batches: texts 1 to 1</span>
output
<span class="co">#&gt; # A tibble: 3 x 5</span>
<span class="co">#&gt;   req                             count relevance positions_in_te… keyword</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;int&gt; &lt;chr&gt;     &lt;list&gt;           &lt;chr&gt;  </span>
<span class="co">#&gt; 1 &quot;A panel of Goldman Sachs empl…     3 0.978     &lt;int [3]&gt;        Wall S…</span>
<span class="co">#&gt; 2 &quot;A panel of Goldman Sachs empl…     2 0.652     &lt;int [2]&gt;        Silico…</span>
<span class="co">#&gt; 3 &quot;A panel of Goldman Sachs empl…     1 0.543     &lt;int [1]&gt;        millio…</span>
output2 &lt;-<span class="st"> </span><span class="kw">monkey_extract</span>(text,
                          <span class="dt">extractor_id =</span> <span class="st">&quot;ex_y7BPYzNG&quot;</span>,
                          <span class="dt">params =</span> <span class="kw">list</span>(<span class="dt">max_keywords =</span> <span class="dv">1</span>))
<span class="co">#&gt; Processing batch 1 of 1 batches: texts 1 to 1</span>
output2
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   req                             count relevance positions_in_te… keyword</span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;int&gt; &lt;chr&gt;     &lt;list&gt;           &lt;chr&gt;  </span>
<span class="co">#&gt; 1 &quot;A panel of Goldman Sachs empl…     3 0.978     &lt;int [3]&gt;        Wall S…</span>
<span class="kw">attr</span>(output2, <span class="st">&quot;headers&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 11</span>
<span class="co">#&gt;   server  date   content.type transfer.encodi… connection x.query.limit.l…</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;           </span>
<span class="co">#&gt; 1 nginx/… Fri, … application… chunked          keep-alive 100000          </span>
<span class="co">#&gt; # ... with 5 more variables: x.query.limit.remaining &lt;chr&gt;,</span>
<span class="co">#&gt; #   x.query.limit.request.queries &lt;chr&gt;, allow &lt;chr&gt;,</span>
<span class="co">#&gt; #   content.encoding &lt;chr&gt;, text_md5 &lt;chr&gt;</span></code></pre></div>
</div>
<div id="how-to-find-extractors" class="section level2">
<h2>How to find extractors?</h2>
<p>You can find extractors and their IDs, including extractors for text in Spanish, at <a href="https://app.monkeylearn.com/main/explore" class="uri">https://app.monkeylearn.com/main/explore</a></p>
<p>There is no endpoint for automatically finding all extractors, but if you find one in the website you particularly like and use a lot in your language and application, you could choose to save its id as an environment variable as explained <a href="http://stat545.com/bit003_api-key-env-var.html">here</a>. Reading about extractors on the website will give you a good overview of their characteristics and original application.</p>
<p>Here are a few ones for text in English:</p>
<ul>
<li><p><a href="https://app.monkeylearn.com/extraction/extractors/ex_isnnZRbS/tab/description-tab">Entity extractor</a>, <code>extractor_id = &quot;ex_isnnZRbS&quot;</code> (used in the first example). Extract Entities from text using Named Entity Recognition (NER). NER labels sequences of words in a text which are the names of things, such as person and company names. This implementation labels 3 classes: PERSON, ORGANIZATION and LOCATION. This NER tagger is implemented using Conditional Random Field (CRF) sequence models.</p></li>
<li><p><a href="https://app.monkeylearn.com/extraction/extractors/ex_y7BPYzNG/tab/description-tab">Keyword extractor</a>, <code>extractor_id = &quot;ex_y7BPYzNG&quot;</code>. Extract keywords from text in English. Keywords can be compounded by one or more words and are defined as the important topics in your content and can be used to index data, generate tag clouds or for searching. This keyword extraction algorithm employs statistical algorithms and natural language processing technology to analyze your content and identify the relevant keywords.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> &quot;A panel of Goldman Sachs employees spent a recent Tuesday night at the Columbia University faculty club trying to convince a packed room of potential recruits that Wall Street, not Silicon Valley, was the place to be for computer scientists.</span>

<span class="st">The Goldman employees knew they had an uphill battle. They were fighting against perceptions of Wall Street as boring and regulation-bound and Silicon Valley as the promised land of flip-flops, beanbag chairs and million-dollar stock options.</span>

<span class="st">Their argument to the room of technologically inclined students was that Wall Street was where they could find far more challenging, diverse and, yes, lucrative jobs working on some of the world’s most difficult technical problems.</span>

<span class="st">“Whereas in other opportunities you might be considering, it is working one type of data or one type of application, we deal in hundreds of products in hundreds of markets, with thousands or tens of thousands of clients, every day, millions of times of day worldwide,” Afsheen Afshar, a managing director at Goldman Sachs, told the students.&quot;</span>

<span class="kw">monkey_extract</span>(text, <span class="dt">extractor_id =</span> <span class="st">&quot;ex_y7BPYzNG&quot;</span>)
<span class="co">#&gt; # A tibble: 10 x 5</span>
<span class="co">#&gt;    req                            count relevance positions_in_te… keyword</span>
<span class="co">#&gt;    &lt;chr&gt;                          &lt;int&gt; &lt;chr&gt;     &lt;list&gt;           &lt;chr&gt;  </span>
<span class="co">#&gt;  1 &quot;A panel of Goldman Sachs emp…     3 0.978     &lt;int [3]&gt;        Wall S…</span>
<span class="co">#&gt;  2 &quot;A panel of Goldman Sachs emp…     2 0.652     &lt;int [2]&gt;        Silico…</span>
<span class="co">#&gt;  3 &quot;A panel of Goldman Sachs emp…     1 0.543     &lt;int [1]&gt;        millio…</span>
<span class="co">#&gt;  4 &quot;A panel of Goldman Sachs emp…     1 0.543     &lt;int [1]&gt;        Goldma…</span>
<span class="co">#&gt;  5 &quot;A panel of Goldman Sachs emp…     1 0.543     &lt;int [1]&gt;        Univer…</span>
<span class="co">#&gt;  6 &quot;A panel of Goldman Sachs emp…     1 0.543     &lt;int [1]&gt;        recent…</span>
<span class="co">#&gt;  7 &quot;A panel of Goldman Sachs emp…     1 0.543     &lt;int [1]&gt;        diffic…</span>
<span class="co">#&gt;  8 &quot;A panel of Goldman Sachs emp…     2 0.435     &lt;int [2]&gt;        thousa…</span>
<span class="co">#&gt;  9 &quot;A panel of Goldman Sachs emp…     2 0.435     &lt;int [2]&gt;        type   </span>
<span class="co">#&gt; 10 &quot;A panel of Goldman Sachs emp…     2 0.435     &lt;int [2]&gt;        hundre…</span></code></pre></div>
<ul>
<li><a href="https://app.monkeylearn.com/extraction/extractors/ex_dqRio5sG/tab/description-tab">Useful data extractor</a>, <code>extractor_id = &quot;ex_dqRio5sG&quot;</code>. Extract useful data from text. This algorithm can be used to detect many different useful data: links, phones, ips, prices, times, emails, bitcoin addresses, dates, ipv6s, hex colors and credit cards.</li>
</ul>
<p>When using this extractor, the format of the API output is a bit different than for other extractors, see below how the output looks like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> &quot;Hi, my email is john@example.com and my credit card is 4242-4242-4242-4242 so you can charge me with $10. My phone number is 15555 9876. We can get in touch on April 16, at 10:00am&quot;</span>
text2 &lt;-<span class="st"> &quot;Hi, my email is mary@example.com and my credit card is 4242-4232-4242-4242. My phone number is 16655 9876. We can get in touch on April 16, at 10:00am&quot;</span>

<span class="kw">monkey_extract</span>(<span class="kw">c</span>(text, text2), <span class="dt">extractor_id =</span> <span class="st">&quot;ex_dqRio5sG&quot;</span>, <span class="dt">unnest =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; # A tibble: 2 x 12</span>
<span class="co">#&gt;   req        dates links phones ipv6s hex_colors ips   credit_cards prices</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; </span>
<span class="co">#&gt; 1 Hi, my em… Apri… exam… 15555… &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  4242-4242-4… $10   </span>
<span class="co">#&gt; 2 Hi, my em… Apri… exam… 16655… &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;  4242-4232-4… &lt;NA&gt;  </span>
<span class="co">#&gt; # ... with 3 more variables: times &lt;chr&gt;, emails &lt;chr&gt;,</span>
<span class="co">#&gt; #   bitcoin_addresses &lt;chr&gt;</span></code></pre></div>
</div>
</div>
<div id="classify" class="section level1">
<h1>Classify</h1>
<div id="a-first-example-1" class="section level2">
<h2>A first example</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text1 &lt;-<span class="st"> &quot;my dog is an avid rice eater&quot;</span>
text2 &lt;-<span class="st"> &quot;i want to buy an iphone&quot;</span>
request &lt;-<span class="st"> </span><span class="kw">c</span>(text1, text2)

<span class="kw">monkey_classify</span>(request, <span class="dt">classifier_id =</span> <span class="st">&quot;cl_oFKL5wft&quot;</span>)
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   req                          category_id probability label             </span>
<span class="co">#&gt;   &lt;chr&gt;                              &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;             </span>
<span class="co">#&gt; 1 my dog is an avid rice eater    18313097      0.130  Pets              </span>
<span class="co">#&gt; 2 my dog is an avid rice eater    18313108      0.239  Dogs              </span>
<span class="co">#&gt; 3 my dog is an avid rice eater    18313113      0.0820 Dog Food          </span>
<span class="co">#&gt; 4 i want to buy an iphone         18314739      0.113  Cell Phones       </span>
<span class="co">#&gt; 5 i want to buy an iphone         18314740      0.186  Accessories       </span>
<span class="co">#&gt; 6 i want to buy an iphone         18314741      0.0940 Cases &amp; Protectors</span></code></pre></div>
</div>
<div id="how-to-find-classifiers" class="section level2">
<h2>How to find classifiers?</h2>
<p>You can find classifiers and their IDs at <a href="https://app.monkeylearn.com/main/explore" class="uri">https://app.monkeylearn.com/main/explore</a> or you can use the <code>monkeylearn_classifiers</code> function, choosing to show all classifiers or only the private ones with <code>private = TRUE</code>. The first column of the resulting data.frame is the <code>classifier_id</code> to be used in <code>monkeylearn_classify</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">monkeylearn_classifiers</span>(<span class="dt">private =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; # A tibble: 45 x 19</span>
<span class="co">#&gt;    classifier_id name   description      train_state train_job_id language</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt;       &lt;lgl&gt;        &lt;chr&gt;   </span>
<span class="co">#&gt;  1 cl_gBhyCMCs   Custo… Detects if huma… TRAINED     NA           en      </span>
<span class="co">#&gt;  2 cl_Aiu8dfYF   Custo… &quot;Classifies cus… DIRTY       NA           en      </span>
<span class="co">#&gt;  3 cl_N3VzxNLN   Custo… Differentiates … TRAINED     NA           en      </span>
<span class="co">#&gt;  4 cl_csyzaevo   Role … &quot;Classifies job… DIRTY       NA           en      </span>
<span class="co">#&gt;  5 cl_pX4g5EEF   Custo… Helps to detect… TRAINED     NA           en      </span>
<span class="co">#&gt;  6 cl_Jx8qzYJh   Senti… Detect sentimen… TRAINED     NA           en      </span>
<span class="co">#&gt;  7 cl_sGdE8hD9   NPS S… Classify NPS re… DIRTY       NA           en      </span>
<span class="co">#&gt;  8 cl_T7XMb74S   IAB T… Classifies text… TRAINED     NA           en      </span>
<span class="co">#&gt;  9 cl_nLW3yR6m   Telco… Classify custom… TRAINED     NA           en      </span>
<span class="co">#&gt; 10 cl_4LqLD7cN   Telco… Detect the topi… TRAINED     NA           en      </span>
<span class="co">#&gt; # ... with 35 more rows, and 13 more variables: ngram_range &lt;chr&gt;,</span>
<span class="co">#&gt; #   use_stemmer &lt;lgl&gt;, stop_words &lt;chr&gt;, max_features &lt;int&gt;,</span>
<span class="co">#&gt; #   strip_stopwords &lt;lgl&gt;, is_multilabel &lt;lgl&gt;, is_twitter_data &lt;lgl&gt;,</span>
<span class="co">#&gt; #   normalize_weights &lt;lgl&gt;, classifier &lt;chr&gt;, industry &lt;chr&gt;,</span>
<span class="co">#&gt; #   classifier_type &lt;chr&gt;, text_type &lt;chr&gt;, permissions &lt;chr&gt;</span></code></pre></div>
<p>Here are a few other examples:</p>
<ul>
<li><a href="https://app.monkeylearn.com/categorizer/projects/cl_oJNMkt2V/tab/main-tab">Language detection</a>, <code>classifier_id = &quot;cl_oJNMkt2V&quot;</code>. Detect language in text. New languages were added for a total of 48 different languages arranged in language families.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text1 &lt;-<span class="st"> &quot;Hauràs de dirigir-te al punt de trobada del grup al que et vulguis unir.&quot;</span>
text2 &lt;-<span class="st"> &quot;i want to buy an iphone&quot;</span>
text3 &lt;-<span class="st"> &quot;Je déteste ne plus avoir de dentifrice.&quot;</span>
request &lt;-<span class="st"> </span><span class="kw">c</span>(text1, text2, text3)

<span class="kw">monkey_classify</span>(request, <span class="dt">classifier_id =</span> <span class="st">&quot;cl_oJNMkt2V&quot;</span>)
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   req                                      category_id probability label  </span>
<span class="co">#&gt;   &lt;chr&gt;                                          &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; 1 Hauràs de dirigir-te al punt de trobada…    53876647       1.00  Italic </span>
<span class="co">#&gt; 2 Hauràs de dirigir-te al punt de trobada…    53876648       0.642 Catala…</span>
<span class="co">#&gt; 3 i want to buy an iphone                     53876636       0.384 German…</span>
<span class="co">#&gt; 4 i want to buy an iphone                     53876639       0.613 Englis…</span>
<span class="co">#&gt; 5 Je déteste ne plus avoir de dentifrice.     53876647       0.995 Italic </span>
<span class="co">#&gt; 6 Je déteste ne plus avoir de dentifrice.     53876649       0.887 French…</span></code></pre></div>
<ul>
<li><a href="https://app.monkeylearn.com/categorizer/projects/cl_KFXhoTdt/tab/main-tab">Profanity and abuse detection</a>, <code>classifier_id = &quot;cl_KFXhoTdt&quot;</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text1 &lt;-<span class="st"> &quot;I think this is awesome.&quot;</span>
text2 &lt;-<span class="st"> &quot;Holy shit! You did great!&quot;</span>
request &lt;-<span class="st"> </span><span class="kw">c</span>(text1, text2)

<span class="kw">monkey_classify</span>(request, <span class="dt">classifier_id =</span> <span class="st">&quot;cl_KFXhoTdt&quot;</span>)
<span class="co">#&gt; # A tibble: 2 x 4</span>
<span class="co">#&gt;   req                       category_id probability label    </span>
<span class="co">#&gt;   &lt;chr&gt;                           &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt; 1 I think this is awesome.     22375077       0.803 clean    </span>
<span class="co">#&gt; 2 Holy shit! You did great!    22375076       0.997 profanity</span></code></pre></div>
<ul>
<li><a href="https://app.monkeylearn.com/categorizer/projects/cl_5icAVzKR/tab/">General topic classifier</a>, <code>classifier_id = &quot;cl_5icAVzKR&quot;</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">text1 &lt;-<span class="st"> &quot;Let me tell you about my dog and my cat. They are really friendly and like going on walks. They both like chasing mice.&quot;</span>
text2 &lt;-<span class="st"> &quot;My first R package was probably a disaster but I keep learning how to program.&quot;</span>
request &lt;-<span class="st"> </span><span class="kw">c</span>(text1, text2)
<span class="kw">monkey_classify</span>(request, <span class="dt">classifier_id =</span> <span class="st">&quot;cl_5icAVzKR&quot;</span>)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   req                                    category_id probability label    </span>
<span class="co">#&gt;   &lt;chr&gt;                                        &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt; 1 Let me tell you about my dog and my c…       64600       0.894 Animals  </span>
<span class="co">#&gt; 2 Let me tell you about my dog and my c…       64608       0.649 Mammals  </span>
<span class="co">#&gt; 3 Let me tell you about my dog and my c…       64611       0.869 Land Mam…</span>
<span class="co">#&gt; 4 My first R package was probably a dis…       64638       0.240 Computer…</span>
<span class="co">#&gt; 5 My first R package was probably a dis…       64640       0.252 Internet</span></code></pre></div>
</div>
</div>
<div id="get-what-you-paid-for" class="section level1">
<h1>Get what you paid for</h1>
<p>Monkeylearn offers a different service based on your current plan, that is, “free”, “team” or “business”. These plans will both influence your <em>rate limiting</em> (how fast?) and your <em>query limiting</em> (how many queries?). See <a href="https://monkeylearn.com/pricing/" class="uri">https://monkeylearn.com/pricing/</a>. Thanks to your MONKEYLEARN_PLAN environment variable, the rate will be handled automatically thanks to <a href="https://github.com/tarakc02/ratelimitr"><code>ratelimitr</code></a>.</p>
<div id="check-the-number-of-remaining-calls" class="section level2">
<h2>Check the number of remaining calls</h2>
<p>After each call to a function you can check how many calls to the API you can still make using <code>attr(output, &quot;headers&quot;)$x.query.limit.remaining</code> and <code>attr(output, &quot;headers&quot;)$x.query.limit.limit</code>. The period after which <code>attr(output, &quot;headers&quot;)$x.query.limit.remaining</code> depends on your subscription and is not included in the output.</p>
</div>
</div>
<div id="fit-monkeylearn-into-your-pipeline" class="section level1">
<h1>Fit <code>monkeylearn</code> into your pipeline!</h1>
<p>You can:</p>
<ul>
<li>Send a vector of texts <em>or</em> a dataframe and a named column (unquoted)</li>
<li>Output either a nested or unnested dataframe
<ul>
<li>Nested = 1 row per input; unnested = 1 row per output</li>
</ul></li>
<li>This output
<ul>
<li>Relates each input text to its (usually) multiple classifications/extractions</li>
<li>Retains a record of inputs that could not be classified/extracted (e.g., empty strings)</li>
</ul></li>
<li>Batch requests</li>
</ul>
<div id="in-a-bit-more-detail" class="section level2">
<h2>In a bit more detail</h2>
<p>You can classify or extract a vector or dataframe of texts while relating the original input text to its classifications. This is important, because the input:output relationship may not always (and in fact, is not usually) 1:1. These functions retain the tie between each <code>input</code><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> element and all of its output elements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Emma Woodhouse, handsome, clever, and rich, with a comfortable home&quot;</span>,     
 <span class="st">&quot;and happy disposition, seemed to unite some of the best blessings of&quot;</span>,  
 <span class="st">&quot;existence; and had lived nearly twenty-one years in the world with very&quot;</span>, 
 <span class="st">&quot;little to distress or vex her.&quot;</span>,                                          
 <span class="st">&quot;&quot;</span>,                   <span class="co"># &lt;--- note the empty string!                                                   </span>
 <span class="st">&quot;She was the youngest of the two daughters of a most affectionate,&quot;</span>,       
 <span class="st">&quot;indulgent father; and had, in consequence of her sister's marriage, been&quot;</span>,
 <span class="st">&quot;mistress of his house from a very early period. Her mother had died&quot;</span>,     
 <span class="st">&quot;too long ago for her to have more than an indistinct remembrance of&quot;</span>,     
 <span class="st">&quot;her caresses; and her place had been supplied by an excellent woman as&quot;</span>,  
 <span class="st">&quot;governess, who had fallen little short of a mother in affection.&quot;</span>)</code></pre></div>
<p>That is true even if you have inputs that cannot be processed. For instance, empty string and <code>NA</code> input elements are not sent to the API for classification/extraction. (You’ll get a warning of this if <code>verbose = TRUE</code>.) We’ve got one above to illustrate and elements that returned no classifications/extractions are included in the resulting dataframe. This way you’ll know which inputs could not be processed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(output &lt;-<span class="st"> </span><span class="kw">monkey_classify</span>(input, <span class="dt">unnest =</span> <span class="ot">FALSE</span>))
<span class="co">#&gt; Using classifier ID cl_oFKL5wft; to find other classifiers, run monkeylearn_classifiers() or visit https://app.monkeylearn.com/main/explore/</span>
<span class="co">#&gt; The following indices were empty strings and could not be sent to the API: 5. They will still be included in the output.</span>
<span class="co">#&gt; Processing batch 1 of 1 batches: texts 1 to 10</span>
<span class="co">#&gt; # A tibble: 11 x 2</span>
<span class="co">#&gt;    req                                                     res            </span>
<span class="co">#&gt;    &lt;chr&gt;                                                   &lt;list&gt;         </span>
<span class="co">#&gt;  1 Emma Woodhouse, handsome, clever, and rich, with a com… &lt;data.frame [4…</span>
<span class="co">#&gt;  2 and happy disposition, seemed to unite some of the bes… &lt;data.frame [3…</span>
<span class="co">#&gt;  3 existence; and had lived nearly twenty-one years in th… &lt;data.frame [3…</span>
<span class="co">#&gt;  4 little to distress or vex her.                          &lt;data.frame [4…</span>
<span class="co">#&gt;  5 &quot;&quot;                                                      &lt;data.frame [1…</span>
<span class="co">#&gt;  6 She was the youngest of the two daughters of a most af… &lt;data.frame [4…</span>
<span class="co">#&gt;  7 indulgent father; and had, in consequence of her siste… &lt;data.frame [3…</span>
<span class="co">#&gt;  8 mistress of his house from a very early period. Her mo… &lt;data.frame [3…</span>
<span class="co">#&gt;  9 too long ago for her to have more than an indistinct r… &lt;data.frame [4…</span>
<span class="co">#&gt; 10 her caresses; and her place had been supplied by an ex… &lt;data.frame [3…</span>
<span class="co">#&gt; 11 governess, who had fallen little short of a mother in … &lt;data.frame [4…</span></code></pre></div>
<p><br></p>
<p>If there are more than 20 empty inputs, we save your console by messaging only the first 20 indices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(very_empty_input &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;&quot;</span>, <span class="dv">25</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">c</span>(input) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sample</span>())
<span class="co">#&gt;  [1] &quot;&quot;                                                                        </span>
<span class="co">#&gt;  [2] &quot;governess, who had fallen little short of a mother in affection.&quot;        </span>
<span class="co">#&gt;  [3] &quot;&quot;                                                                        </span>
<span class="co">#&gt;  [4] &quot;mistress of his house from a very early period. Her mother had died&quot;     </span>
<span class="co">#&gt;  [5] &quot;and happy disposition, seemed to unite some of the best blessings of&quot;    </span>
<span class="co">#&gt;  [6] &quot;&quot;                                                                        </span>
<span class="co">#&gt;  [7] &quot;&quot;                                                                        </span>
<span class="co">#&gt;  [8] &quot;&quot;                                                                        </span>
<span class="co">#&gt;  [9] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [10] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [11] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [12] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [13] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [14] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [15] &quot;indulgent father; and had, in consequence of her sister's marriage, been&quot;</span>
<span class="co">#&gt; [16] &quot;existence; and had lived nearly twenty-one years in the world with very&quot; </span>
<span class="co">#&gt; [17] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [18] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [19] &quot;little to distress or vex her.&quot;                                          </span>
<span class="co">#&gt; [20] &quot;Emma Woodhouse, handsome, clever, and rich, with a comfortable home&quot;     </span>
<span class="co">#&gt; [21] &quot;too long ago for her to have more than an indistinct remembrance of&quot;     </span>
<span class="co">#&gt; [22] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [23] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [24] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [25] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [26] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [27] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [28] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [29] &quot;She was the youngest of the two daughters of a most affectionate,&quot;       </span>
<span class="co">#&gt; [30] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [31] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [32] &quot;her caresses; and her place had been supplied by an excellent woman as&quot;  </span>
<span class="co">#&gt; [33] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [34] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [35] &quot;&quot;                                                                        </span>
<span class="co">#&gt; [36] &quot;&quot;</span></code></pre></div>
<p>Since the entire original input is represented in the output, if you need to find all of the empty inputs you can easily filter the output to all of the rows containing empty strings.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">monkey_classify</span>(very_empty_input, <span class="dt">unnest =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; Using classifier ID cl_oFKL5wft; to find other classifiers, run monkeylearn_classifiers() or visit https://app.monkeylearn.com/main/explore/</span>
<span class="co">#&gt; The following indices were empty strings and could not be sent to the API. (Displaying first 20): 1, 3, 6, 7, 8, 9, 10, 11, 12, 13, 14, 17, 18, 22, 23, 24, 25, 26, 27, 28... They will still be included in the output.</span>
<span class="co">#&gt; Processing batch 1 of 1 batches: texts 1 to 10</span>
<span class="co">#&gt; # A tibble: 36 x 2</span>
<span class="co">#&gt;    req                                                    res             </span>
<span class="co">#&gt;    &lt;chr&gt;                                                  &lt;list&gt;          </span>
<span class="co">#&gt;  1 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt;  2 governess, who had fallen little short of a mother in… &lt;data.frame [4 …</span>
<span class="co">#&gt;  3 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt;  4 mistress of his house from a very early period. Her m… &lt;data.frame [3 …</span>
<span class="co">#&gt;  5 and happy disposition, seemed to unite some of the be… &lt;data.frame [3 …</span>
<span class="co">#&gt;  6 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt;  7 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt;  8 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt;  9 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt; 10 &quot;&quot;                                                     &lt;data.frame [1 …</span>
<span class="co">#&gt; # ... with 26 more rows</span></code></pre></div>
<div id="configuring-the-output" class="section level3">
<h3>Configuring the Output</h3>
<p>The default output is a nested dataframe with the same number of rows as your input dataframe or the same length as your input vector, depending on which one you sent in.</p>
<p>Let’s take a look at the <code>res</code> output column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output<span class="op">$</span>res
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;   category_id probability         label</span>
<span class="co">#&gt; 1    18313280       0.058         Music</span>
<span class="co">#&gt; 2    18313356       0.052           Pop</span>
<span class="co">#&gt; 3    18313357       0.338      Pop Rock</span>
<span class="co">#&gt; 4    18313358       0.209 Joni Mitchell</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt;   category_id probability                    label</span>
<span class="co">#&gt; 1    18313280       0.088                    Music</span>
<span class="co">#&gt; 2    18313701       0.051         Special Interest</span>
<span class="co">#&gt; 3    18313702       0.816 See all Special Interest</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt;   category_id probability         label</span>
<span class="co">#&gt; 1    18314767       0.076         Books</span>
<span class="co">#&gt; 2    18315016       0.049      Religion</span>
<span class="co">#&gt; 3    18315024       0.139 Inspirational</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt;   category_id probability         label</span>
<span class="co">#&gt; 1    18313280       0.060         Music</span>
<span class="co">#&gt; 2    18313601       0.057         Blues</span>
<span class="co">#&gt; 3    18313612       0.262 Chicago Blues</span>
<span class="co">#&gt; 4    18313614       0.227 Little Milton</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt;   category_id probability label</span>
<span class="co">#&gt; 1          NA          NA    NA</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt;   category_id probability      label</span>
<span class="co">#&gt; 1    18313280       0.059      Music</span>
<span class="co">#&gt; 2    18313459       0.058     World </span>
<span class="co">#&gt; 3    18313469       0.352     Celtic</span>
<span class="co">#&gt; 4    18313471       0.440 Celtic Man</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[7]]</span>
<span class="co">#&gt;   category_id probability                label</span>
<span class="co">#&gt; 1    18314767       0.075                Books</span>
<span class="co">#&gt; 2    18314983       0.057 Parenting &amp; Families</span>
<span class="co">#&gt; 3    18314999       0.057             Marriage</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[8]]</span>
<span class="co">#&gt;   category_id probability            label</span>
<span class="co">#&gt; 1    18314767       0.078            Books</span>
<span class="co">#&gt; 2    18314769       0.046 Children's Books</span>
<span class="co">#&gt; 3    18314788       0.044      Educational</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[9]]</span>
<span class="co">#&gt;   category_id probability                        label</span>
<span class="co">#&gt; 1    18313280       0.061                        Music</span>
<span class="co">#&gt; 2    18313584       0.063             Children's Music</span>
<span class="co">#&gt; 3    18313589       0.383       Children's Sing-a-Long</span>
<span class="co">#&gt; 4    18313590       0.285 Various Artists-Sing-A-Longs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[10]]</span>
<span class="co">#&gt;   category_id probability               label</span>
<span class="co">#&gt; 1    18314767       0.058               Books</span>
<span class="co">#&gt; 2    18314839       0.045 Biography &amp; Memoirs</span>
<span class="co">#&gt; 3    18314851       0.082           Religious</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[11]]</span>
<span class="co">#&gt;   category_id probability            label</span>
<span class="co">#&gt; 1    18314767       0.068            Books</span>
<span class="co">#&gt; 2    18314769       0.049 Children's Books</span>
<span class="co">#&gt; 3    18314784       0.042          Animals</span>
<span class="co">#&gt; 4    18314785       0.504          Rabbits</span></code></pre></div>
<p>You can easily choose an unnested output by setting the <strong>unnest flag</strong> to TRUE (which it is by default) to get one row per classification/extraction.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(output_unnested &lt;-<span class="st"> </span><span class="kw">monkey_classify</span>(input, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, <span class="dt">unnest =</span> <span class="ot">TRUE</span>))
<span class="co">#&gt; # A tibble: 36 x 4</span>
<span class="co">#&gt;    req                               category_id probability label        </span>
<span class="co">#&gt;    &lt;chr&gt;                                   &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;        </span>
<span class="co">#&gt;  1 Emma Woodhouse, handsome, clever…    18313280      0.0580 Music        </span>
<span class="co">#&gt;  2 Emma Woodhouse, handsome, clever…    18313356      0.0520 Pop          </span>
<span class="co">#&gt;  3 Emma Woodhouse, handsome, clever…    18313357      0.338  Pop Rock     </span>
<span class="co">#&gt;  4 Emma Woodhouse, handsome, clever…    18313358      0.209  Joni Mitchell</span>
<span class="co">#&gt;  5 and happy disposition, seemed to…    18313280      0.0880 Music        </span>
<span class="co">#&gt;  6 and happy disposition, seemed to…    18313701      0.0510 Special Inte…</span>
<span class="co">#&gt;  7 and happy disposition, seemed to…    18313702      0.816  See all Spec…</span>
<span class="co">#&gt;  8 existence; and had lived nearly …    18314767      0.0760 Books        </span>
<span class="co">#&gt;  9 existence; and had lived nearly …    18315016      0.0490 Religion     </span>
<span class="co">#&gt; 10 existence; and had lived nearly …    18315024      0.139  Inspirational</span>
<span class="co">#&gt; # ... with 26 more rows</span></code></pre></div>
<p>We could have gotten the same result by sending in a dataframe and a named column. If a dataframe is supplied input column is not renamed to <code>req</code> as it is when input is a vector; the original column name is retained.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">input_df &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">text =</span> input) 
output_df_unnested &lt;-<span class="st"> </span><span class="kw">monkey_classify</span>(input_df, text, <span class="dt">unnest =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">req =</span> text)

testthat<span class="op">::</span><span class="kw">expect_equal</span>(output_unnested, output_df_unnested)</code></pre></div>
<p><br></p>
<p>If the input is a dataframe, setting the <code>.keep_all</code> option to TRUE allows you to retain all input columns. If FALSE, only the column you specify for classification will be retained.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sw &lt;-<span class="st"> </span>dplyr<span class="op">::</span>starwars <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(name, height) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">sample_n</span>(<span class="kw">nrow</span>(input_df))

sw_input_df &lt;-<span class="st"> </span>input_df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">bind_cols</span>(sw)

sw_input_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">monkey_classify</span>(text, <span class="dt">unnest =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; # A tibble: 11 x 4</span>
<span class="co">#&gt;    name                  height text                            res       </span>
<span class="co">#&gt;    &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;                           &lt;list&gt;    </span>
<span class="co">#&gt;  1 Lama Su                  229 Emma Woodhouse, handsome, clev… &lt;data.fra…</span>
<span class="co">#&gt;  2 Jocasta Nu               167 and happy disposition, seemed … &lt;data.fra…</span>
<span class="co">#&gt;  3 Wicket Systri Warrick     88 existence; and had lived nearl… &lt;data.fra…</span>
<span class="co">#&gt;  4 Jango Fett               183 little to distress or vex her.  &lt;data.fra…</span>
<span class="co">#&gt;  5 Shaak Ti                 178 &quot;&quot;                              &lt;data.fra…</span>
<span class="co">#&gt;  6 Yoda                      66 She was the youngest of the tw… &lt;data.fra…</span>
<span class="co">#&gt;  7 IG-88                    200 indulgent father; and had, in … &lt;data.fra…</span>
<span class="co">#&gt;  8 Ben Quadinaros           163 mistress of his house from a v… &lt;data.fra…</span>
<span class="co">#&gt;  9 Taun We                  213 too long ago for her to have m… &lt;data.fra…</span>
<span class="co">#&gt; 10 Lando Calrissian         177 her caresses; and her place ha… &lt;data.fra…</span>
<span class="co">#&gt; 11 Captain Phasma            NA governess, who had fallen litt… &lt;data.fra…</span></code></pre></div>
</div>
<div id="batching" class="section level3">
<h3>Batching</h3>
<p>Retaining the relationship between input and output doesn’t mean you’ll need to send requests one-by-one. <strong>Batch requests</strong> by setting the <code>texts_per_req</code> value which governs the number of texts that are sent per request. Per the <a href="http://help.monkeylearn.com/frequently-asked-questions/queries/can-i-classify-or-extract-more-than-one-text-with-one-api-request">MonkeyLearn documentation</a>, the maximum we recommend sending at once is 200 requests.</p>
<p>If <code>texts_per_req</code> is NULL, the default, we try to optimize the response time from the API by setting <code>texts_per_req</code> to 200 when your input has more than 200 texts or to the length of the <code>input</code> if you’ve got fewer. You’ll see a significant speedup by batching your requests this way. However, batching doesn’t save you on queries; a batch of 150 texts still uses up 150 queries.</p>
<p>These functions also include some more verbose <strong>progress reporting</strong>, letting you know what batch you’re on out of the total, and which texts are set to be processed in that batch.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">one_by_one &lt;-<span class="st"> </span><span class="kw">system.time</span>(output &lt;-<span class="st"> </span><span class="kw">monkey_classify</span>(input, <span class="dt">texts_per_req =</span> <span class="dv">1</span>))
<span class="co">#&gt; Using classifier ID cl_oFKL5wft; to find other classifiers, run monkeylearn_classifiers() or visit https://app.monkeylearn.com/main/explore/</span>
<span class="co">#&gt; The following indices were empty strings and could not be sent to the API: 5. They will still be included in the output.</span>
<span class="co">#&gt; Processing batch 1 of 10 batches: texts 1 to 1</span>
<span class="co">#&gt; Processing batch 2 of 10 batches: texts 1 to 2</span>
<span class="co">#&gt; Processing batch 3 of 10 batches: texts 2 to 3</span>
<span class="co">#&gt; Processing batch 4 of 10 batches: texts 3 to 4</span>
<span class="co">#&gt; Processing batch 5 of 10 batches: texts 4 to 5</span>
<span class="co">#&gt; Processing batch 6 of 10 batches: texts 5 to 6</span>
<span class="co">#&gt; Processing batch 7 of 10 batches: texts 6 to 7</span>
<span class="co">#&gt; Processing batch 8 of 10 batches: texts 7 to 8</span>
<span class="co">#&gt; Processing batch 9 of 10 batches: texts 8 to 9</span>
<span class="co">#&gt; Processing batch 10 of 10 batches: texts 9 to 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  ------------- </span>
<span class="co">#&gt; Still working! </span>
<span class="co">#&gt;  -------------- </span>
<span class="co">#&gt;               \   </span>
<span class="co">#&gt;                \  </span>
<span class="co">#&gt;                 \</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;                   .=&quot;=.</span>
<span class="co">#&gt;                 _/.-.-.\_     _</span>
<span class="co">#&gt;                ( ( o o ) )    ))</span>
<span class="co">#&gt;                 |/  &quot;  \|    //</span>
<span class="co">#&gt;                  \'---'/    //</span>
<span class="co">#&gt;            jgs   /`&quot;&quot;&quot;`\\  ((</span>
<span class="co">#&gt;                 / /_,_\ \\  \\</span>
<span class="co">#&gt;                 \_\_'__/  \  ))</span>
<span class="co">#&gt;                 /`  /`~\   |//</span>
<span class="co">#&gt;                /   /    \  /</span>
<span class="co">#&gt;           ,--`,--'\/\    /</span>
<span class="co">#&gt;           '-- &quot;--'  '--'</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">batch_of_five &lt;-<span class="st"> </span><span class="kw">system.time</span>(output &lt;-<span class="st"> </span><span class="kw">monkey_classify</span>(input, <span class="dt">texts_per_req =</span> <span class="dv">5</span>))
<span class="co">#&gt; Using classifier ID cl_oFKL5wft; to find other classifiers, run monkeylearn_classifiers() or visit https://app.monkeylearn.com/main/explore/</span>
<span class="co">#&gt; The following indices were empty strings and could not be sent to the API: 5. They will still be included in the output.</span>
<span class="co">#&gt; Processing batch 1 of 2 batches: texts 1 to 5</span>
<span class="co">#&gt; Processing batch 2 of 2 batches: texts 5 to 10</span></code></pre></div>
<p>How much does sending 5 texts in a batch vs. 1 text improve our processing time?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(speedup &lt;-<span class="st"> </span>one_by_one[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>batch_of_five[<span class="dv">1</span>])
<span class="co">#&gt; user.self </span>
<span class="co">#&gt;       4.7</span></code></pre></div>
<p>A 3-4x speedup isn’t so bad! Worth keeping in mind that if you need the blazing fast speeds you might consider upgrading to a higher MonkeyLearn price tier.</p>
<p><br></p>
<hr />
<p><br></p>
</div>
</div>
</div>
<div id="meta" class="section level1">
<h1>Meta</h1>
<ul>
<li>Please <a href="https://github.com/ropensci/monkeylearn/issues">report any issues or bugs</a>.</li>
<li>License: GPL</li>
<li>Get citation information for <code>monkeylearn</code> in R doing <code>citation(package = 'monkeylearn')</code></li>
<li>Please note that this project is released with a <a href="CONDUCT.md">Contributor Code of Conduct</a>. By participating in this project you agree to abide by its terms.</li>
<li>This package is part of the <a href="https://ropensci.org/">rOpenSci project</a>.</li>
</ul>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Thanks to <a href="https://juliasilge.com/">Julia Silge</a>’s fantastic <a href="https://github.com/juliasilge/janeaustenr"><code>janeaustenr</code></a> package for this text!<a href="#fnref1">↩</a></p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
